# Form implementation generated from reading ui file 'TAGUpdate_Window.ui'
#
# Created by: PySide6 UI code generator 6.4.1
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.

import sys
from PySide6 import QtCore, QtGui, QtWidgets
import pandas as pd
import psycopg2
from config import config
import os

basedir = r"\\ERP-EIPSA-DATOS\Comunes\EIPSA-ERP"


class Ui_TAGUpdate_Window(object):
    """
    UI class for the Update Tag window.
    """
    def setupUi(self, TAGUpdate_Window):
        """
        Sets up the user interface for the TAGUpdate_Window.

        Args:
            TAGUpdate_Window (QtWidgets.QMainWindow): The main window for the UI setup.
        """
        TAGUpdate_Window.setObjectName("TAGUpdate_Window")
        TAGUpdate_Window.resize(640, 330)
        TAGUpdate_Window.setMinimumSize(QtCore.QSize(640, 330))
        TAGUpdate_Window.setMaximumSize(QtCore.QSize(640, 330))
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        TAGUpdate_Window.setWindowIcon(icon)
        TAGUpdate_Window.setStyleSheet(
"QPushButton {\n"
"background-color: #33bdef;\n"
"  border: 1px solid transparent;\n"
"  border-radius: 3px;\n"
"  color: #fff;\n"
"  font-family: -apple-system,system-ui,\"Segoe UI\",\"Liberation Sans\",sans-serif;\n"
"  font-size: 15px;\n"
"  font-weight: 800;\n"
"  line-height: 1.15385;\n"
"  margin: 0;\n"
"  outline: none;\n"
"  padding: 8px .8em;\n"
"  text-align: center;\n"
"  text-decoration: none;\n"
"  vertical-align: baseline;\n"
"  white-space: nowrap;\n"
"}\n"
"\n"
"QPushButton:hover {\n"
"    background-color: #019ad2;\n"
"    border-color: rgb(0, 0, 0);\n"
"}\n"
"\n"
"QPushButton:pressed {\n"
"    background-color: rgb(1, 140, 190);\n"
"    border-color: rgb(255, 255, 255);\n"
"}")
        self.centralwidget = QtWidgets.QWidget(parent=TAGUpdate_Window)
        self.centralwidget.setObjectName("centralwidget")
        self.gridLayout = QtWidgets.QGridLayout(self.centralwidget)
        self.gridLayout.setObjectName("gridLayout")
        self.frame = QtWidgets.QFrame(parent=self.centralwidget)
        self.frame.setFrameShape(QtWidgets.QFrame.Shape.StyledPanel)
        self.frame.setFrameShadow(QtWidgets.QFrame.Shadow.Raised)
        self.frame.setObjectName("frame")
        self.verticalLayout = QtWidgets.QVBoxLayout(self.frame)
        self.verticalLayout.setObjectName("verticalLayout")
        self.hLayout = QtWidgets.QHBoxLayout()
        self.hLayout.setObjectName("hLayout")
        self.label_SelectFile = QtWidgets.QLabel(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_SelectFile.setFont(font)
        self.label_SelectFile.setObjectName("label_SelectFile")
        self.hLayout.addWidget(self.label_SelectFile)
        self.Button_Select = QtWidgets.QPushButton(parent=self.frame)
        self.Button_Select.setMinimumSize(QtCore.QSize(250, 35))
        self.Button_Select.setMaximumSize(QtCore.QSize(250, 35))
        self.Button_Select.setObjectName("Button_Select")
        self.hLayout.addWidget(self.Button_Select)
        self.verticalLayout.addLayout(self.hLayout)
        self.label_name_file = QtWidgets.QLabel(parent=self.frame)
        self.label_name_file.setMinimumSize(QtCore.QSize(0, 25))
        self.label_name_file.setMaximumSize(QtCore.QSize(16777215, 25))
        self.label_name_file.setObjectName("label_name_file")
        self.verticalLayout.addWidget(self.label_name_file)
        self.hLayout1 = QtWidgets.QHBoxLayout()
        self.hLayout1.setObjectName("hLayout1")
        self.label_ItemType = QtWidgets.QLabel(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_ItemType.setFont(font)
        self.label_ItemType.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignTop)
        self.label_ItemType.setObjectName("label_ItemType")
        self.hLayout1.addWidget(self.label_ItemType)
        self.vLayout = QtWidgets.QVBoxLayout()
        self.vLayout.setObjectName("vLayout")
        self.radioFlow = QtWidgets.QRadioButton(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.radioFlow.setFont(font)
        self.radioFlow.setObjectName("radioFlow")
        self.vLayout.addWidget(self.radioFlow)
        self.radioTemp = QtWidgets.QRadioButton(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.radioTemp.setFont(font)
        self.radioTemp.setObjectName("radioTemp")
        self.vLayout.addWidget(self.radioTemp)
        self.radioLevel = QtWidgets.QRadioButton(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.radioLevel.setFont(font)
        self.radioLevel.setObjectName("radioLevel")
        self.vLayout.addWidget(self.radioLevel)
        self.radioOthers = QtWidgets.QRadioButton(parent=self.frame)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.radioOthers.setFont(font)
        self.radioOthers.setObjectName("radioOthers")
        self.vLayout.addWidget(self.radioOthers)
        self.hLayout1.addLayout(self.vLayout)
        self.verticalLayout.addLayout(self.hLayout1)
        spacerItem = QtWidgets.QSpacerItem(20, 20, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout.addItem(spacerItem)
        self.hLayout2 = QtWidgets.QHBoxLayout()
        self.hLayout2.setObjectName("hLayout2")
        self.Button_Update = QtWidgets.QPushButton(parent=self.frame)
        self.Button_Update.setMinimumSize(QtCore.QSize(250, 35))
        self.Button_Update.setMaximumSize(QtCore.QSize(250, 35))
        self.Button_Update.setObjectName("Button_Update")
        self.hLayout2.addWidget(self.Button_Update)
        self.Button_Cancel = QtWidgets.QPushButton(parent=self.frame)
        self.Button_Cancel.setMinimumSize(QtCore.QSize(250, 35))
        self.Button_Cancel.setMaximumSize(QtCore.QSize(250, 35))
        self.Button_Cancel.setObjectName("Button_Cancel")
        self.hLayout2.addWidget(self.Button_Cancel)
        self.verticalLayout.addLayout(self.hLayout2)
        self.gridLayout.addWidget(self.frame, 0, 0, 1, 1)
        TAGUpdate_Window.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(parent=TAGUpdate_Window)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 640, 22))
        self.menubar.setObjectName("menubar")
        TAGUpdate_Window.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(parent=TAGUpdate_Window)
        self.statusbar.setObjectName("statusbar")
        TAGUpdate_Window.setStatusBar(self.statusbar)

        self.retranslateUi(TAGUpdate_Window)
        self.Button_Cancel.clicked.connect(TAGUpdate_Window.close)
        self.Button_Select.clicked.connect(self.browsefiles) # type: ignore
        self.Button_Update.clicked.connect(self.updatetag)

        QtCore.QMetaObject.connectSlotsByName(TAGUpdate_Window)


# Function to translate and updates the text of various UI elements
    def retranslateUi(self, TAGUpdate_Window):
        """
        Translates and updates the text of various UI elements.
        """
        _translate = QtCore.QCoreApplication.translate
        TAGUpdate_Window.setWindowTitle(_translate("TAGUpdate_Window", "Actualizar TAG"))
        self.label_SelectFile.setText(_translate("TAGUpdate_Window", "Seleccionar archivo:"))
        self.Button_Select.setText(_translate("TAGUpdate_Window", "Seleccionar"))
        self.label_name_file.setText(_translate("TAGUpdate_Window", ""))
        self.label_ItemType.setText(_translate("TAGUpdate_Window", "Tipo de equipo:"))
        self.radioFlow.setText(_translate("TAGUpdate_Window", "Caudal"))
        self.radioTemp.setText(_translate("TAGUpdate_Window", "Temperatura"))
        self.radioLevel.setText(_translate("TAGUpdate_Window", "Nivel"))
        self.radioOthers.setText(_translate("TAGUpdate_Window", "Otros"))
        self.Button_Update.setText(_translate("TAGUpdate_Window", "Actualizar"))
        self.Button_Cancel.setText(_translate("TAGUpdate_Window", "Cancelar"))


    def browsefiles(self):
        """
        Opens a file dialog for the user to select an Excel file.
        """
        fname, _ = QtWidgets.QFileDialog.getOpenFileName(None, "Seleccionar archivo Excel", "", "Archivos de Excel (*.xlsx)")
        if fname:
            self.label_name_file.setText("Archivo: " + fname)


    def updatetag(self):
        """
        Imports excel file and updates tags data.
        """
        if self.label_name_file.text()=='':
            dlg = QtWidgets.QMessageBox()
            new_icon = QtGui.QIcon()
            new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
            dlg.setWindowIcon(new_icon)
            dlg.setWindowTitle("ERP EIPSA")
            dlg.setText("Selecciona un archivo para actualizar")
            dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
            dlg.exec()
            del dlg, new_icon

        else:
            excel_file=self.label_name_file.text().split("Archivo: ")[1]

            params = config()
            conn = psycopg2.connect(**params)
            cursor = conn.cursor()

        #Importing excel file into dataframe
            df_table = pd.read_excel(excel_file, na_values=['N/A'], keep_default_na=False, skiprows=7, dtype={'plate_thk': str})
            df_table = df_table.astype(str)
            df_table.replace('nan', 'N/A', inplace=True)

            if self.radioFlow.isChecked()==True:
                table_name='tags_data.tags_flow'
                df = df_table.iloc[:,:35]
                df_final = df[df['actualizar'] == 'X']
                df_final = df_final.drop(['num_offer', 'actualizar'], axis=1)

                try:
                    for index, row in df_final.iterrows():
                        if "ID" in row and "tag" in row:
                            id_value = row["ID"]
                            tag_value = row["tag"]

                        # Creating string for columns names and values
                            columns_values = [(column, row[column]) for column in df_final.columns if not pd.isnull(row[column])]
                            columns = ', '.join([column for column, _ in columns_values])
                            values = ', '.join([f"'{values.replace('.', ',')}'" if column in ['amount','plate_thk']
                                                else ('NULL' if values == '' and column in ['num_order','contractual_date']
                                                else f"'{values}'") for column, values in columns_values])

                        # Creating the SET  and WHERE clause with proper formatting
                            set_clause = ", ".join([f"{column} = {value}" for column, value in zip(columns.split(", ")[2:], values.split(", ")[2:])])
                            where_clause = f'"id_tag_flow" = \'{id_value}\''

                        # Creating the update query and executing it after checking existing tags and id
                            sql_update = f'UPDATE {table_name} SET {set_clause} WHERE {where_clause}'
                            sql_check = f'SELECT * FROM {table_name} WHERE "id_tag_flow" = \'{id_value}\''
                            cursor.execute(sql_check)
                            result_check=cursor.fetchall()

                            if len(result_check) == 0:
                                dlg = QtWidgets.QMessageBox()
                                new_icon = QtGui.QIcon()
                                new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                                dlg.setWindowIcon(new_icon)
                                dlg.setWindowTitle("ERP EIPSA")
                                dlg.setText(f"El ID \'{id_value}\' no se corresponde con el TAG \'{tag_value}\' \n"
                                            "Este TAG no se actualizará")
                                dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                                dlg.exec()
                                del dlg, new_icon

                            else:
                                cursor.execute(sql_update)

                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Datos actualizados con éxito")
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                    dlg.exec()
                    del dlg, new_icon

                # Closing cursor and database connection
                    conn.commit()
                    cursor.close()

                except (Exception, psycopg2.DatabaseError) as error:
                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Ha ocurrido el siguiente error:\n"
                                + str(error))
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                    dlg.exec()
                    del dlg, new_icon
                finally:
                    if conn is not None:
                        conn.close()

            elif self.radioTemp.isChecked()==True:
                table_name='tags_data.tags_temp'
                df = df_table.iloc[:,:40]
                df_final = df[df['actualizar'] == 'X']
                df_final = df_final.drop(['num_offer', 'actualizar'], axis=1)

                try:
                    for index, row in df_final.iterrows():
                        if "ID" in row and "tag" in row:
                            id_value = row["ID"]
                            tag_value = row["tag"]

                        # Creating string for columns names and values
                            columns_values = [(column, row[column]) for column in df_final.columns if not pd.isnull(row[column])]
                            columns = ', '.join([column for column, _ in columns_values])
                            values = ', '.join([
                                                f"'{int(float(values))}'" if column in ['rating', 'sheath_stem_diam', 'nipple_ext_length', 'temp_inf', 'temp_sup', 'root_diam', 'tip_diam'] and values.endswith('.0')
                                                else f"'{values.replace('.', ',')}'" if column in ['amount', 'root_diam', 'tip_diam', 'sheath_stem_diam']
                                                else ('NULL' if values == 'N/A' and column in ['std_length', 'ins_length']
                                                else ('NULL' if values == '' and column in ['num_order','contractual_date']
                                                else f"'{values}'")) for column, values in columns_values
                                                ])

                        # Creating the SET  and WHERE clause with proper formatting
                            set_clause = ", ".join([f"{column} = {value}" for column, value in zip(columns.split(", ")[2:], values.split(", ")[2:])])
                            where_clause = f'"id_tag_temp" = \'{id_value}\''

                        # Creating the update query and executing it after checking existing tags and id
                            sql_update = f'UPDATE {table_name} SET {set_clause} WHERE {where_clause}'
                            sql_check = f'SELECT * FROM {table_name} WHERE "id_tag_temp" = \'{id_value}\''
                            cursor.execute(sql_check)
                            result_check=cursor.fetchall()

                            if len(result_check) == 0:
                                dlg = QtWidgets.QMessageBox()
                                new_icon = QtGui.QIcon()
                                new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                                dlg.setWindowIcon(new_icon)
                                dlg.setWindowTitle("ERP EIPSA")
                                dlg.setText(f"El ID \'{id_value}\' no se corresponde con el TAG \'{tag_value}\' \n"
                                            "Este TAG no se actualizará")
                                dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                                dlg.exec()
                                del dlg, new_icon

                            else:
                                cursor.execute(sql_update)

                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Datos actualizados con éxito")
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                    dlg.exec()
                    del dlg, new_icon

                # Closing cursor and database connection
                    conn.commit()
                    cursor.close()

                except (Exception, psycopg2.DatabaseError) as error:
                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Ha ocurrido el siguiente error:\n"
                                + str(error))
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                    dlg.exec()
                    del dlg, new_icon
                finally:
                    if conn is not None:
                        conn.close()

            elif self.radioLevel.isChecked()==True:
                table_name= 'tags_data.tags_level'
                df = df_table.iloc[:,:41]
                df_final = df[df['actualizar'] == 'X']
                df_final = df_final.drop(['num_offer', 'actualizar'], axis=1)

                try:
                    for index, row in df_final.iterrows():
                        if "ID" in row and "tag" in row:
                            id_value = row["ID"]
                            tag_value = row["tag"]

                        # Creating string for columns names and values
                            columns_values = [(column, row[column]) for column in df_final.columns if not pd.isnull(row[column])]
                            columns = ', '.join([column for column, _ in columns_values])
                            values = ', '.join([
                                                f"'{int(float(values))}'" if column in ['proc_conn_rating', 'dv_rating'] and values.endswith('.0')
                                                else f"'{values.replace('.', ',')}'" if column in ['amount']
                                                else ('NULL' if values == 'N/A' and column in ['visibility', 'cc_length']
                                                else ('NULL' if values == '' and column in ['num_order','contractual_date']
                                                else f"'{values}'")) for column, values in columns_values
                                                ])

                        # Creating the SET  and WHERE clause with proper formatting
                            set_clause = ", ".join([f"{column} = {value}" for column, value in zip(columns.split(", ")[2:], values.split(", ")[2:])])
                            where_clause = f'"id_tag_level" = \'{id_value}\''

                        # Creating the update query and executing it after checking existing tags and id
                            sql_update = f'UPDATE {table_name} SET {set_clause} WHERE {where_clause}'
                            sql_check = f'SELECT * FROM {table_name} WHERE "id_tag_level" = \'{id_value}\''
                            cursor.execute(sql_check)
                            result_check=cursor.fetchall()

                            if len(result_check) == 0:
                                dlg = QtWidgets.QMessageBox()
                                new_icon = QtGui.QIcon()
                                new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                                dlg.setWindowIcon(new_icon)
                                dlg.setWindowTitle("ERP EIPSA")
                                dlg.setText(f"El ID \'{id_value}\' no se corresponde con el TAG \'{tag_value}\' \n"
                                            "Este TAG no se actualizará")
                                dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                                dlg.exec()
                                del dlg, new_icon

                            else:
                                cursor.execute(sql_update)

                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Datos actualizados con éxito")
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                    dlg.exec()
                    del dlg, new_icon

                # Closing cursor and database connection
                    conn.commit()
                    cursor.close()

                except (Exception, psycopg2.DatabaseError) as error:
                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Ha ocurrido el siguiente error:\n"
                                + str(error))
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                    dlg.exec()
                    del dlg, new_icon
                finally:
                    if conn is not None:
                        conn.close()

            elif self.radioOthers.isChecked()==True:
                table_name= 'tags_data.tags_others'
                df = df_table.iloc[:,:16]
                df_final = df[df['actualizar'] == 'X']
                df_final = df_final.drop(['num_offer', 'actualizar'], axis=1)

                try:
                    for index, row in df_final.iterrows():
                        if "ID" in row and "tag" in row:
                            id_value = row["ID"]
                            tag_value = row["tag"]

                        # Creating string for columns names and values
                            columns_values = [(column, row[column]) for column in df_final.columns if not pd.isnull(row[column])]
                            columns = ', '.join([column for column, _ in columns_values])
                            values = ', '.join([
                                                f"'{values.replace('.', ',')}'" if column in ['amount']
                                                else f"'{values}'" for column, values in columns_values
                                                ])

                        # Creating the SET  and WHERE clause with proper formatting
                            set_clause = ", ".join([f"{column} = {value}" for column, value in zip(columns.split(", ")[2:], values.split(", ")[2:])])
                            where_clause = f'"id_tag_others" = \'{id_value}\''

                        # Creating the update query and executing it after checking existing tags and id
                            sql_update = f'UPDATE {table_name} SET {set_clause} WHERE {where_clause}'
                            sql_check = f'SELECT * FROM {table_name} WHERE "id_tag_others" = \'{id_value}\''
                            cursor.execute(sql_check)
                            result_check=cursor.fetchall()

                            if len(result_check) == 0:
                                dlg = QtWidgets.QMessageBox()
                                new_icon = QtGui.QIcon()
                                new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                                dlg.setWindowIcon(new_icon)
                                dlg.setWindowTitle("ERP EIPSA")
                                dlg.setText(f"El ID \'{id_value}\' no se corresponde con el TAG \'{tag_value}\' \n"
                                            "Este TAG no se actualizará")
                                dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                                dlg.exec()
                                del dlg, new_icon

                            else:
                                cursor.execute(sql_update)

                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Datos actualizados con éxito")
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                    dlg.exec()
                    del dlg, new_icon

                # Closing cursor and database connection
                    conn.commit()
                    cursor.close()

                except (Exception, psycopg2.DatabaseError) as error:
                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Ha ocurrido el siguiente error:\n"
                                + str(error))
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                    dlg.exec()
                    del dlg, new_icon
                finally:
                    if conn is not None:
                        conn.close()


            else:
                table_name= '' 
                dlg = QtWidgets.QMessageBox()
                new_icon = QtGui.QIcon()
                new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                dlg.setWindowIcon(new_icon)
                dlg.setWindowTitle("ERP EIPSA")
                dlg.setText("Selecciona un tipo de equipo")
                dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                dlg.exec()
                del dlg, new_icon

            self.label_name_file.setText("")


if __name__ == "__main__":
    app = QtWidgets.QApplication(sys.argv)
    TAGUpdate_Window = QtWidgets.QMainWindow()
    ui = Ui_TAGUpdate_Window()
    ui.setupUi(TAGUpdate_Window)
    TAGUpdate_Window.show()
    sys.exit(app.exec())
