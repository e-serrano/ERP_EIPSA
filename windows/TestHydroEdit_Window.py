# Form implementation generated from reading ui file 'TestHydroEdit_Window.ui'
#
# Created by: PySide6 UI code generator 6.4.2
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.


from PySide6 import QtCore, QtGui, QtWidgets
from config.config_functions import config
import psycopg2
import os
import re
from datetime import *

basedir = r"\\ERP-EIPSA-DATOS\Comunes\EIPSA-ERP"


class AlignDelegate(QtWidgets.QStyledItemDelegate):
    """
    A custom item delegate for aligning cell content in a QTableView or QTableWidget to the center.

    Inherits from:
        QtWidgets.QStyledItemDelegate: Provides custom rendering and editing for table items.

    """
    def initStyleOption(self, option, index):
        """
        Initializes the style option for the item, setting its display alignment to center.

        Args:
            option (QtWidgets.QStyleOptionViewItem): The style option to initialize.
            index (QtCore.QModelIndex): The model index of the item.
        """
        super(AlignDelegate, self).initStyleOption(option, index)
        option.displayAlignment = QtCore.Qt.AlignmentFlag.AlignCenter

class CustomTableWidget(QtWidgets.QTableWidget):
    """
    Custom QTableWidget that supports filtering and sorting features.

    Attributes:
        list_filters (list): Stores filters applied to the table.
        column_filters (dict): Maps column indices to sets of applied filters.
        column_actions (dict): Maps column indices to actions related to columns.
        checkbox_states (dict): Stores the state of checkboxes for filtering.
        rows_hidden (dict): Maps column indices to sets of hidden row indices.
        general_rows_to_hide (set): Set of row indices that are hidden across the table.
    """
    def __init__(self, parent=None):
        """
        Initializes the CustomTableWidget.

        Sets up the initial state of the widget, including filters, checkbox states, 
        and hidden rows.

        Args:
            parent (QWidget, optional): The parent widget of this table. Defaults to None.
        """
        super().__init__(parent)
        self.list_filters=[]
        self.column_filters = {}
        self.column_actions = {}
        self.checkbox_states = {}
        self.rows_hidden = {}
        self.general_rows_to_hide = set()

# Function to show the menu
    def show_unique_values_menu(self, column_index, header_pos, header_height):
        """
        Displays a context menu for unique values in a specified column.

        The menu includes options to remove filters, sort the column, and filter by text. 
        It also allows the user to select/unselect unique values via checkboxes.

        Args:
            column_index (int): The index of the column for which the menu is displayed.
            header_pos (QPoint): The position of the header in the viewport.
            header_height (int): The height of the header.
        """
        menu = QtWidgets.QMenu(self)
        actionDeleteFilterColumn = QtGui.QAction("Quitar Filtro")
        actionDeleteFilterColumn.triggered.connect(lambda: self.delete_filter(column_index))
        menu.addAction(actionDeleteFilterColumn)
        menu.addSeparator()
        actionOrderAsc = menu.addAction("Ordenar Ascendente")
        actionOrderAsc.triggered.connect(lambda: self.sort_column(column_index, QtCore.Qt.SortOrder.AscendingOrder))
        actionOrderDesc = menu.addAction("Ordenar Descendente")
        actionOrderDesc.triggered.connect(lambda: self.sort_column(column_index, QtCore.Qt.SortOrder.DescendingOrder))
        menu.addSeparator()
        actionFilterByText = menu.addAction("Buscar Texto")
        actionFilterByText.triggered.connect(lambda: self.filter_by_text(column_index))
        menu.addSeparator()

        menu.setStyleSheet("QMenu::item:selected { background-color: #33bdef; }"
                        "QMenu::item:pressed { background-color: rgb(1, 140, 190); }")

        if column_index not in self.column_filters:
            self.column_filters[column_index] = set()

        scroll_menu = QtWidgets.QScrollArea()
        scroll_menu.setWidgetResizable(True)
        scroll_widget = QtWidgets.QWidget(scroll_menu)
        scroll_menu.setWidget(scroll_widget)
        scroll_layout = QtWidgets.QVBoxLayout(scroll_widget)

        checkboxes = []

        select_all_checkbox = QtWidgets.QCheckBox("Seleccionar todo")
        if column_index in self.checkbox_states:
            select_all_checkbox.setCheckState(QtCore.Qt.CheckState(self.checkbox_states[column_index].get("Seleccionar todo", QtCore.Qt.CheckState(2))))
        else:
            select_all_checkbox.setCheckState(QtCore.Qt.CheckState(2))
        scroll_layout.addWidget(select_all_checkbox)
        checkboxes.append(select_all_checkbox)

        unique_values = self.get_unique_values(column_index)
        filtered_values = self.get_filtered_values()

        for value in sorted(unique_values):
            checkbox = QtWidgets.QCheckBox(value)
            if select_all_checkbox.isChecked(): 
                checkbox.setCheckState(QtCore.Qt.CheckState(2))
            else:
                if column_index in self.checkbox_states and value in self.checkbox_states[column_index]:
                    checkbox.setCheckState(QtCore.Qt.CheckState(self.checkbox_states[column_index][value]))
                elif filtered_values is None or value in filtered_values[column_index]:
                    checkbox.setCheckState(QtCore.Qt.CheckState(2))
                else:
                    checkbox.setCheckState(QtCore.Qt.CheckState(0))
            scroll_layout.addWidget(checkbox)
            checkboxes.append(checkbox)

        select_all_checkbox.stateChanged.connect(lambda state: self.set_all_checkboxes_state(checkboxes, state, column_index))

        for value, checkbox in zip(sorted(unique_values), checkboxes[1:]):
            checkbox.stateChanged.connect(lambda checked, value=value, checkbox=checkbox: self.apply_filter(column_index, value, checked))

    # Action for drop down menu and adding scroll area as widget
        action_scroll_menu = QtWidgets.QWidgetAction(menu)
        action_scroll_menu.setDefaultWidget(scroll_menu)
        menu.addAction(action_scroll_menu)

        menu.exec(header_pos - QtCore.QPoint(0, header_height))


# Function to delete filter on selected column
    def delete_filter(self,column_index):
        """
        Removes the filter applied to the specified column.

        Unhides previously hidden rows and resets the checkbox state for the column.

        Args:
            column_index (int): The index of the column from which to delete the filter.
        """
        if column_index in self.column_filters:
            del self.column_filters[column_index]
        if column_index in self.checkbox_states:
            del self.checkbox_states[column_index]
        if column_index in self.rows_hidden:
            for item in self.rows_hidden[column_index]:
                self.setRowHidden(item, False)
                if item in self.general_rows_to_hide:
                    self.general_rows_to_hide.remove(item)
            del self.rows_hidden[column_index]
        header_item = self.horizontalHeaderItem(column_index)
        header_item.setIcon(QtGui.QIcon())


# Function to set all checkboxes state
    def set_all_checkboxes_state(self, checkboxes, state, column_index):
        """
        Sets the state of all checkboxes in the filter menu for a specific column.

        Args:
            checkboxes (list): List of checkboxes to update.
            state (Qt.CheckState): The desired state for the checkboxes.
            column_index (int): The index of the column for which the checkboxes are set.
        """
        if column_index not in self.checkbox_states:
            self.checkbox_states[column_index] = {}

        for checkbox in checkboxes:
            checkbox.setCheckState(QtCore.Qt.CheckState(state))

        self.checkbox_states[column_index]["Seleccionar todo"] = state


# Function to apply filters to table
    def apply_filter(self, column_index, value, checked, text_filter=None, filter_dialog=None):
        """
        Applies a filter to the specified column based on the checkbox state and optional text filter.

        Args:
            column_index (int): The index of the column to filter.
            value (str): The value to filter by.
            checked (bool): Indicates if the filter should be applied (True) or removed (False).
            text_filter (str, optional): Additional text filter for filtering items. Defaults to None.
            filter_dialog (QDialog, optional): The dialog used for the text filter. Defaults to None.
        """
        if column_index not in self.column_filters:
            self.column_filters[column_index] = set()

        if text_filter is None:
            if value is None:
                self.column_filters[column_index] = set()
            elif checked:
                self.column_filters[column_index].add(value)
            elif value in self.column_filters[column_index]:
                self.column_filters[column_index].remove(value)

        rows_to_hide = set()
        for row in range(self.rowCount()):
            show_row = True

            # Check filters for all columns
            for col, filters in self.column_filters.items():
                item = self.item(row, col)
                if item:
                    item_value = item.text()
                    if text_filter is None:
                        if filters and item_value not in filters:
                            show_row = False
                            break

        # Filtering by text
            if text_filter is not None:
                filter_dialog.accept()
                item = self.item(row, column_index)
                if item:
                    if text_filter.upper() in item.text().upper():
                        self.column_filters[column_index].add(item.text())
                    else:
                        show_row = False

            if not show_row:
                if row not in self.general_rows_to_hide:
                    self.general_rows_to_hide.add(row)
                    rows_to_hide.add(row)
            else:
                if row in self.general_rows_to_hide:
                    self.general_rows_to_hide.remove(row)

        # Update hidden rows for this column depending on checkboxes
        if checked and text_filter is None:
            if column_index not in self.rows_hidden:
                self.rows_hidden[column_index] = set(rows_to_hide)
            else:
                self.rows_hidden[column_index].update(rows_to_hide)

        # Update hidden rows for this column depending on filtered text
        if text_filter is not None and value is None:
            if column_index not in self.rows_hidden:
                self.rows_hidden[column_index] = set(rows_to_hide)
            else:
                self.rows_hidden[column_index].update(rows_to_hide)

        # Iterate over all rows to hide them as necessary
        for row in range(self.rowCount()):
            self.setRowHidden(row, row in self.general_rows_to_hide)

        header_item = self.horizontalHeaderItem(column_index)
        if len(self.general_rows_to_hide) > 0:
            header_item.setIcon(QtGui.QIcon(os.path.abspath(os.path.join(basedir, "Resources/Iconos/Filter_Active.png"))))
        else:
            header_item.setIcon(QtGui.QIcon())

# Function to apply filters to table based on a desired text
    def filter_by_text(self, column_index):
        """
        Opens a dialog for filtering the specified column by text input.

        Args:
            column_index (int): The index of the column to filter.
        """
        filter_dialog = QtWidgets.QDialog(self)
        filter_dialog.setWindowTitle("Filtrar por texto")
        
        label = QtWidgets.QLabel("Texto a filtrar:")
        text_input = QtWidgets.QLineEdit()
        
        filter_button = QtWidgets.QPushButton("Filtrar")
        filter_button.setStyleSheet("QPushButton {\n"
"background-color: #33bdef;\n"
"  border: 1px solid transparent;\n"
"  border-radius: 3px;\n"
"  color: #fff;\n"
"  font-family: -apple-system,system-ui,\"Segoe UI\",\"Liberation Sans\",sans-serif;\n"
"  font-size: 15px;\n"
"  font-weight: 800;\n"
"  line-height: 1.15385;\n"
"  margin: 0;\n"
"  outline: none;\n"
"  padding: 2px .8em;\n"
"  text-align: center;\n"
"  text-decoration: none;\n"
"  vertical-align: baseline;\n"
"  white-space: nowrap;\n"
"}\n"
"\n"
"QPushButton:hover {\n"
"    background-color: #019ad2;\n"
"    border-color: rgb(0, 0, 0);\n"
"}\n"
"\n"
"QPushButton:pressed {\n"
"    background-color: rgb(1, 140, 190);\n"
"    border-color: rgb(255, 255, 255);\n"
"}")
        filter_button.clicked.connect(lambda: self.apply_filter(column_index, None, False, text_input.text(), filter_dialog))

        layout = QtWidgets.QVBoxLayout()
        layout.addWidget(label)
        layout.addWidget(text_input)
        layout.addWidget(filter_button)

        filter_dialog.setLayout(layout)
        filter_dialog.exec()


# Function to obtain the unique matching applied filters 
    def get_unique_values(self, column_index):
        """
        Retrieves unique values from the specified column, taking into account any active filters on other columns.

        Args:
            column_index (int): The index of the column from which to retrieve unique values.

        Returns:
            set: A set of unique values from the specified column that are visible based on the current filters.
        """
        unique_values = set()
        for row in range(self.rowCount()):
            show_row = True
            for col, filters in self.column_filters.items():
                if col != column_index:
                    item = self.item(row, col)
                    if item:
                        item_value = item.text()
                        if filters and item_value not in filters:
                            show_row = False
                            break
            if show_row:
                item = self.item(row, column_index)
                if item:
                    unique_values.add(item.text())
        return unique_values

# Function to get values filtered by all columns
    def get_filtered_values(self):
        """
        Gets the current filter values for all columns.

        Returns:
            dict: A dictionary where each key is a column index and the value is a set of filters applied to that column.
        """
        filtered_values = {}
        for col, filters in self.column_filters.items():
            filtered_values[col] = filters
        return filtered_values

# Function to sort column
    def sort_column(self, column_index, sortOrder):
        """
        Sorts the specified column based on the given order. If the column is a date column, a custom sort method is used.

        Args:
            column_index (int): The index of the column to sort.
            sortOrder (Qt.SortOrder): The order to sort the column (ascending or descending).
        """
        if self.horizontalHeaderItem(column_index).text() in ['Fecha PH1', 'Fecha PH2']:
            self.custom_sort(column_index, sortOrder)
        else:
            self.sortByColumn(column_index, sortOrder)

# Function to sort column based on special datatypes
    def custom_sort(self, column, order):
        """
        Custom sorting method for date columns. Sorts the specified column based on date values.

        Args:
            column (int): The index of the column to sort.
            order (Qt.SortOrder): The order to sort the column (ascending or descending).
        """
        row_count = self.rowCount()

        indexes = list(range(row_count))
        indexes.sort(key=lambda i: QtCore.QDateTime.fromString(self.item(i, column).text(), "dd-MM-yyyy"))

        if order == QtCore.Qt.SortOrder.DescendingOrder:
            indexes.reverse()

        hidden_rows = [row for row in range(row_count) if self.isRowHidden(row)]

        rows = self.rowCount()
        for i in range(rows):
            self.insertRow(i)

        for new_row, old_row in enumerate(indexes):
            for col in range(self.columnCount()):
                item = self.takeItem(old_row + rows, col)
                self.setItem(new_row, col, item)

        for i in range(rows):
            self.removeRow(rows)

        for row in hidden_rows:
            self.setRowHidden(row, True)

# Function with the menu configuration
    def contextMenuEvent(self, event):
        """
        Handles the context menu event for the table. Shows a menu for filtering unique values when the header is right-clicked.

        Args:
            event (QEvent): The event triggered by the context menu action.
        """
        if self.horizontalHeader().visualIndexAt(event.pos().x()) >= 0:
            logical_index = self.horizontalHeader().logicalIndexAt(event.pos().x())
            header_pos = self.mapToGlobal(self.horizontalHeader().pos())
            header_height = self.horizontalHeader().height()
            self.show_unique_values_menu(logical_index, header_pos, header_height)
        else:
            super().contextMenuEvent(event)

class Ui_TestHydroEdit_Window(QtWidgets.QMainWindow):
    """
    UI class for the Edit Test Hydro window.
    """
    def __init__(self, username, id_item, num_order, tag, description, test_date1, manometer1, pressure1, state1, obs1, test_date2, manometer2, pressure2, state2, obs2, qty):
        """
        Initializes the Ui_TestHydroEdit_Window.

        Args:
            username (str): The username of the user editing the test.
            id_item (str): The ID of the item being tested.
            num_order (str): The order number associated with the test.
            tag (str): The tag identifier for the test.
            description (str): A description of the item or test.
            test_date1 (str): The date of the first hydro test.
            manometer1 (str): The manometer reading for the first test.
            pressure1 (float): The pressure for the first test.
            state1 (str): The state or status of the first test.
            obs1 (str): Additional observations for the first test.
            test_date2 (str): The date of the second hydro test.
            manometer2 (str): The manometer reading for the second test.
            pressure2 (float): The pressure for the second test.
            state2 (str): The state or status of the second test.
            obs2 (str): Additional observations for the second test.
            qty (int): The quantity associated with the test.
        """
        super().__init__()
        self.username = username
        self.id_item = id_item
        self.num_order = num_order
        self.tag = tag
        self.description = description
        self.test_date1 = test_date1
        self.manometer1 = manometer1
        self.pressure1 = pressure1
        self.state1 = state1
        self.obs1 = obs1
        self.test_date2 = test_date2
        self.manometer2 = manometer2
        self.pressure2 = pressure2
        self.state2 = state2
        self.obs2 = obs2
        self.qty = qty
        self.setupUi(self)

    def setupUi(self, TestHydroEdit_Window):
        """
        Sets up the user interface for the TestHydroEdit_Window.

        Args:
            TestHydroEdit_Window (QtWidgets.QMainWindow): The main window for the UI setup.
        """
        TestHydroEdit_Window.setObjectName("TestHydroEdit_Window")
        TestHydroEdit_Window.resize(400, 561)
        TestHydroEdit_Window.setMinimumSize(QtCore.QSize(1000, 675))
        # TestHydroEdit_Window.setMaximumSize(QtCore.QSize(600, 575))
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        TestHydroEdit_Window.setWindowIcon(icon)
        TestHydroEdit_Window.setStyleSheet(
    "QPushButton {\n"
    "background-color: #33bdef;\n"
    "  border: 1px solid transparent;\n"
    "  border-radius: 3px;\n"
    "  color: #fff;\n"
    "  font-family: -apple-system,system-ui,\"Segoe UI\",\"Liberation Sans\",sans-serif;\n"
    "  font-size: 15px;\n"
    "  font-weight: 800;\n"
    "  line-height: 1.15385;\n"
    "  margin: 0;\n"
    "  outline: none;\n"
    "  padding: 2px .8em;\n"
    "  text-align: center;\n"
    "  text-decoration: none;\n"
    "  vertical-align: baseline;\n"
    "  white-space: nowrap;\n"
    "}\n"
    "\n"
    "QPushButton:hover {\n"
    "    background-color: #019ad2;\n"
    "    border-color: rgb(0, 0, 0);\n"
    "}\n"
    "\n"
    "QPushButton:pressed {\n"
    "    background-color: rgb(1, 140, 190);\n"
    "    border-color: rgb(255, 255, 255);\n"
    "}")
        self.centralwidget = QtWidgets.QWidget(parent=TestHydroEdit_Window)
        self.centralwidget.setObjectName("centralwidget")
        self.gridLayout = QtWidgets.QGridLayout(self.centralwidget)
        self.gridLayout.setObjectName("gridLayout")
        self.frame = QtWidgets.QFrame(parent=self.centralwidget)
        self.frame.setFrameShape(QtWidgets.QFrame.Shape.StyledPanel)
        self.frame.setFrameShadow(QtWidgets.QFrame.Shadow.Raised)
        self.frame.setObjectName("frame")
        self.gridLayout_2 = QtWidgets.QGridLayout(self.frame)
        self.gridLayout_2.setObjectName("gridLayout_2")
        spacerItem2 = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.gridLayout_2.addItem(spacerItem2, 0, 0, 1, 2)
        self.label_id = QtWidgets.QLabel(parent=self.frame)
        self.label_id.setMinimumSize(QtCore.QSize(105, 25))
        self.label_id.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_id.setFont(font)
        self.label_id.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_id.setObjectName("label_id")
        self.gridLayout_2.addWidget(self.label_id, 1, 0, 1, 1)
        self.id_test = QtWidgets.QLineEdit(parent=self.frame)
        self.id_test.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.id_test.setFont(font)
        self.id_test.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.id_test.setObjectName("id_test")
        self.id_test.setEnabled(False)
        self.gridLayout_2.addWidget(self.id_test, 1, 1, 1, 2)
        self.label_order = QtWidgets.QLabel(parent=self.frame)
        self.label_order.setMinimumSize(QtCore.QSize(105, 25))
        self.label_order.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_order.setFont(font)
        self.label_order.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_order.setObjectName("label_order")
        self.gridLayout_2.addWidget(self.label_order, 1, 3, 1, 1)
        self.num_order_test = QtWidgets.QLineEdit(parent=self.frame)
        self.num_order_test.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.num_order_test.setFont(font)
        self.num_order_test.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.num_order_test.setObjectName("num_order_test")
        self.gridLayout_2.addWidget(self.num_order_test, 1, 4, 1, 2)
        self.label_tag = QtWidgets.QLabel(parent=self.frame)
        self.label_tag.setMinimumSize(QtCore.QSize(105, 25))
        self.label_tag.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_tag.setFont(font)
        self.label_tag.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_tag.setObjectName("label_tag")
        self.gridLayout_2.addWidget(self.label_tag, 2, 0, 1, 1)
        self.tag_test = QtWidgets.QLineEdit(parent=self.frame)
        self.tag_test.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.tag_test.setFont(font)
        self.tag_test.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.tag_test.setObjectName("tag_test")
        self.gridLayout_2.addWidget(self.tag_test, 2, 1, 1, 1)
        self.label_description = QtWidgets.QLabel(parent=self.frame)
        self.label_description.setMinimumSize(QtCore.QSize(105, 25))
        self.label_description.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_description.setFont(font)
        self.label_description.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_description.setObjectName("label_description")
        self.gridLayout_2.addWidget(self.label_description, 2, 2, 1, 1)
        self.description_test = QtWidgets.QLineEdit(parent=self.frame)
        self.description_test.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.description_test.setFont(font)
        self.description_test.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.description_test.setObjectName("description_test")
        self.gridLayout_2.addWidget(self.description_test, 2, 3, 1, 1)
        self.label_quantity = QtWidgets.QLabel(parent=self.frame)
        self.label_quantity.setMinimumSize(QtCore.QSize(105, 25))
        self.label_quantity.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_quantity.setFont(font)
        self.label_quantity.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_quantity.setObjectName("label_quantity")
        self.gridLayout_2.addWidget(self.label_quantity, 2, 4, 1, 1)
        self.qty_test = QtWidgets.QLineEdit(parent=self.frame)
        self.qty_test.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.qty_test.setFont(font)
        self.qty_test.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.qty_test.setObjectName("qty_test")
        self.gridLayout_2.addWidget(self.qty_test, 2, 5, 1, 1)
        self.label_date1 = QtWidgets.QLabel(parent=self.frame)
        self.label_date1.setMinimumSize(QtCore.QSize(105, 25))
        self.label_date1.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_date1.setFont(font)
        self.label_date1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_date1.setObjectName("label_date1")
        self.gridLayout_2.addWidget(self.label_date1, 3, 0, 1, 1)
        self.date_test1 = QtWidgets.QLineEdit(parent=self.frame)
        self.date_test1.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.date_test1.setFont(font)
        self.date_test1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.date_test1.setObjectName("date_test1")
        self.gridLayout_2.addWidget(self.date_test1, 3, 1, 1, 2)
        self.label_manometer1 = QtWidgets.QLabel(parent=self.frame)
        self.label_manometer1.setMinimumSize(QtCore.QSize(105, 25))
        self.label_manometer1.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_manometer1.setFont(font)
        self.label_manometer1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_manometer1.setObjectName("label_manometer1")
        self.gridLayout_2.addWidget(self.label_manometer1, 4, 0, 1, 1)
        self.manometer_test1 = QtWidgets.QComboBox(parent=self.frame)
        self.manometer_test1.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.manometer_test1.setFont(font)
        self.manometer_test1.setObjectName("manometer_test1")
        self.gridLayout_2.addWidget(self.manometer_test1, 4, 1, 1, 2)
        self.label_pressure1 = QtWidgets.QLabel(parent=self.frame)
        self.label_pressure1.setMinimumSize(QtCore.QSize(115, 25))
        self.label_pressure1.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_pressure1.setFont(font)
        self.label_pressure1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_pressure1.setObjectName("label_pressure1")
        self.gridLayout_2.addWidget(self.label_pressure1, 5, 0, 1, 1)
        self.presure_test1 = QtWidgets.QLineEdit(parent=self.frame)
        self.presure_test1.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.presure_test1.setFont(font)
        self.presure_test1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.presure_test1.setObjectName("presure_test1")
        self.gridLayout_2.addWidget(self.presure_test1, 5, 1, 1, 2)
        self.label_state1 = QtWidgets.QLabel(parent=self.frame)
        self.label_state1.setMinimumSize(QtCore.QSize(115, 25))
        self.label_state1.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_state1.setFont(font)
        self.label_state1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_state1.setObjectName("label_state1")
        self.gridLayout_2.addWidget(self.label_state1, 6, 0, 1, 1)
        self.state_test1 = QtWidgets.QComboBox(parent=self.frame)
        self.state_test1.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.state_test1.setFont(font)
        self.state_test1.setObjectName("state_test1")
        self.gridLayout_2.addWidget(self.state_test1, 6, 1, 1, 2)
        self.label_obs1 = QtWidgets.QLabel(parent=self.frame)
        self.label_obs1.setMinimumSize(QtCore.QSize(115, 25))
        self.label_obs1.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_obs1.setFont(font)
        self.label_obs1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_obs1.setObjectName("label_obs1")
        self.gridLayout_2.addWidget(self.label_obs1, 7, 0, 1, 1)
        self.obs_test1 = QtWidgets.QTextEdit(parent=self.frame)
        self.obs_test1.setMinimumSize(QtCore.QSize(105, 25))
        self.obs_test1.setMaximumSize(QtCore.QSize(16777215, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.obs_test1.setFont(font)
        self.obs_test1.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.obs_test1.setObjectName("obs_test1")
        self.gridLayout_2.addWidget(self.obs_test1, 7, 1, 1, 2)
        self.label_date2 = QtWidgets.QLabel(parent=self.frame)
        self.label_date2.setMinimumSize(QtCore.QSize(105, 25))
        self.label_date2.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_date2.setFont(font)
        self.label_date2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_date2.setObjectName("label_date2")
        self.gridLayout_2.addWidget(self.label_date2, 3, 3, 1, 1)
        self.date_test2 = QtWidgets.QLineEdit(parent=self.frame)
        self.date_test2.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.date_test2.setFont(font)
        self.date_test2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.date_test2.setObjectName("date_test2")
        self.gridLayout_2.addWidget(self.date_test2, 3, 4, 1, 2)
        self.label_manometer2 = QtWidgets.QLabel(parent=self.frame)
        self.label_manometer2.setMinimumSize(QtCore.QSize(105, 25))
        self.label_manometer2.setMaximumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_manometer2.setFont(font)
        self.label_manometer2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_manometer2.setObjectName("label_manometer2")
        self.gridLayout_2.addWidget(self.label_manometer2, 4, 3, 1, 1)
        self.manometer_test2 = QtWidgets.QComboBox(parent=self.frame)
        self.manometer_test2.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.manometer_test2.setFont(font)
        self.manometer_test2.setObjectName("manometer_test2")
        self.gridLayout_2.addWidget(self.manometer_test2, 4, 4, 1, 2)
        self.label_pressure2 = QtWidgets.QLabel(parent=self.frame)
        self.label_pressure2.setMinimumSize(QtCore.QSize(115, 25))
        self.label_pressure2.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_pressure2.setFont(font)
        self.label_pressure2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_pressure2.setObjectName("label_pressure2")
        self.gridLayout_2.addWidget(self.label_pressure2, 5, 3, 1, 1)
        self.presure_test2 = QtWidgets.QLineEdit(parent=self.frame)
        self.presure_test2.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.presure_test2.setFont(font)
        self.presure_test2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.presure_test2.setObjectName("presure_test2")
        self.gridLayout_2.addWidget(self.presure_test2, 5, 4, 1, 2)
        self.label_state2 = QtWidgets.QLabel(parent=self.frame)
        self.label_state2.setMinimumSize(QtCore.QSize(115, 25))
        self.label_state2.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_state2.setFont(font)
        self.label_state2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_state2.setObjectName("label_state2")
        self.gridLayout_2.addWidget(self.label_state2, 6, 3, 1, 1)
        self.state_test2 = QtWidgets.QComboBox(parent=self.frame)
        self.state_test2.setMinimumSize(QtCore.QSize(105, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.state_test2.setFont(font)
        self.state_test2.setObjectName("state_test2")
        self.gridLayout_2.addWidget(self.state_test2, 6, 4, 1, 2)
        self.label_obs2 = QtWidgets.QLabel(parent=self.frame)
        self.label_obs2.setMinimumSize(QtCore.QSize(115, 25))
        self.label_obs2.setMaximumSize(QtCore.QSize(115, 25))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        self.label_obs2.setFont(font)
        self.label_obs2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.label_obs2.setObjectName("label_obs2")
        self.gridLayout_2.addWidget(self.label_obs2, 7, 3, 1, 1)
        self.obs_test2 = QtWidgets.QTextEdit(parent=self.frame)
        self.obs_test2.setMinimumSize(QtCore.QSize(105, 25))
        self.obs_test2.setMaximumSize(QtCore.QSize(16777215, 25))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.obs_test2.setFont(font)
        self.obs_test2.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft|QtCore.Qt.AlignmentFlag.AlignVCenter)
        self.obs_test2.setObjectName("obs_test2")
        self.gridLayout_2.addWidget(self.obs_test2, 7, 4, 1, 2)
        spacerItem1 = QtWidgets.QSpacerItem(40, 20, QtWidgets.QSizePolicy.Policy.Expanding, QtWidgets.QSizePolicy.Policy.Minimum)
        self.gridLayout_2.addItem(spacerItem1, 8, 1, 1, 1)
        self.Button_Edit = QtWidgets.QPushButton(parent=self.frame)
        self.Button_Edit.setMinimumSize(QtCore.QSize(100, 35))
        # self.Button_Edit.setMaximumSize(QtCore.QSize(100, 35))
        self.Button_Edit.setObjectName("Button_Edit")
        self.gridLayout_2.addWidget(self.Button_Edit, 9, 0, 1, 3)
        self.Button_Cancel = QtWidgets.QPushButton(parent=self.frame)
        self.Button_Cancel.setMinimumSize(QtCore.QSize(100, 35))
        # self.Button_Cancel.setMaximumSize(QtCore.QSize(100, 35))
        self.Button_Cancel.setObjectName("Button_Cancel")
        self.gridLayout_2.addWidget(self.Button_Cancel, 9, 3, 1, 3)
        self.gridLayout.addWidget(self.frame, 0, 0, 1, 1)
        TestHydroEdit_Window.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(parent=TestHydroEdit_Window)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 400, 22))
        self.menubar.setObjectName("menubar")
        TestHydroEdit_Window.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(parent=TestHydroEdit_Window)
        self.statusbar.setObjectName("statusbar")
        TestHydroEdit_Window.setStatusBar(self.statusbar)


        self.retranslateUi(TestHydroEdit_Window)
        QtCore.QMetaObject.connectSlotsByName(TestHydroEdit_Window)

        self.Button_Cancel.clicked.connect(TestHydroEdit_Window.close)
        self.Button_Edit.clicked.connect(self.update_hydro)

        self.load_values()

# Function to translate and updates the text of various UI elements
    def retranslateUi(self, TestHydroEdit_Window):
        """
        Translates and updates the text of various UI elements.
        """
        _translate = QtCore.QCoreApplication.translate
        TestHydroEdit_Window.setWindowTitle(_translate("TestHydroEdit_Window", "Prueba Hidrostática"))
        self.label_order.setText(_translate("TestHydroEdit_Window", "Nº Pedido:"))
        self.label_id.setText(_translate("TestHydroEdit_Window", "ID:"))
        self.label_description.setText(_translate("TestHydroEdit_Window", "Descripción:"))
        self.label_tag.setText(_translate("TestHydroEdit_Window", "TAG:"))
        self.label_date1.setText(_translate("TestHydroEdit_Window", "Fecha1:"))
        self.label_manometer1.setText(_translate("TestHydroEdit_Window", "Manómetro1:"))
        self.label_pressure1.setText(_translate("TestHydroEdit_Window", "Presión1:"))
        self.label_state1.setText(_translate("TestHydroEdit_Window", "Estado1:"))
        self.label_obs1.setText(_translate("TestHydroEdit_Window", "Observaciones1:"))
        self.label_date2.setText(_translate("TestHydroEdit_Window", "Fecha2:"))
        self.label_manometer2.setText(_translate("TestHydroEdit_Window", "Manómetro2:"))
        self.label_pressure2.setText(_translate("TestHydroEdit_Window", "Presión2:"))
        self.label_state2.setText(_translate("TestHydroEdit_Window", "Estado2:"))
        self.label_obs2.setText(_translate("TestHydroEdit_Window", "Observaciones2:"))
        self.label_quantity.setText(_translate("TestHydroEdit_Window", "Cantidad:"))
        self.Button_Cancel.setText(_translate("TestHydroEdit_Window", "Cancelar"))
        self.Button_Edit.setText(_translate("TestHydroEdit_Window", "Editar"))


    def update_hydro(self):
        """
        Updates the data for the specific element.
        """
        id_element = int(self.id_test.text())
        num_order = self.num_order_test.text().upper()
        date_test1 = self.date_test1.text()
        notes1 = self.obs_test1.toPlainText()
        test_state1 = self.state_test1.currentText()
        manometer1 = self.manometer_test1.currentText()
        pressure1 = self.presure_test1.text()
        date_test2 = f"'{self.date_test2.text()}'" if self.date_test2.text() != '' else 'NULL'
        notes2 = self.obs_test2.toPlainText()
        test_state2 = self.state_test2.currentText()
        manometer2 = self.manometer_test2.currentText()
        pressure2 = self.presure_test2.text()
        quantity = self.qty_test.text()
        tag = self.tag_test.text()
        description = self.description_test.text()

        if num_order == '' or (date_test1 == '' or (manometer1 == '' or pressure1 == '')):
            dlg = QtWidgets.QMessageBox()
            new_icon = QtGui.QIcon()
            new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
            dlg.setWindowIcon(new_icon)
            dlg.setWindowTitle("ERP EIPSA")
            dlg.setText("Rellena todos los campos. Solo el campo de observaciones puede quedarse vacío")
            dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
            dlg.exec()
            del dlg, new_icon

        elif not re.match(r'^\d{2}[/\-]\d{2}[/\-]\d{4}$', date_test1):
            dlg = QtWidgets.QMessageBox()
            new_icon = QtGui.QIcon()
            new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
            dlg.setWindowIcon(new_icon)
            dlg.setWindowTitle("ERP EIPSA")
            dlg.setText("La fecha debe tener formato dd/mm/yyyy o dd-mm-yyyy")
            dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
            dlg.exec()
            del dlg, new_icon

        elif quantity == '' or not (quantity.isdigit() and int(quantity) > 0):
            dlg_error = QtWidgets.QMessageBox()
            new_icon = QtGui.QIcon()
            new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
            dlg_error.setWindowIcon(new_icon)
            dlg_error.setWindowTitle("Prueba Hidrostática")
            dlg_error.setText("La cantidad no puede estar vacía o no es un valor válido")
            dlg_error.setIcon(QtWidgets.QMessageBox.Icon.Warning)
            dlg_error.exec()
            del dlg_error,new_icon

        else:
            if num_order not in ['ALMACÉN', 'ALMACEN', 'INTERNO', 'PROTOTIPOS']:
                commands_checkorder = ("""
                            SELECT *
                            FROM orders
                            WHERE "num_order" = %s
                            """)
                conn = None
                try:
                # read the connection parameters
                    params = config()
                # connect to the PostgreSQL server
                    conn = psycopg2.connect(**params)
                    cur = conn.cursor()
                # execution of commands one by one
                    cur.execute(commands_checkorder,(num_order,))
                    results=cur.fetchall()
                # close communication with the PostgreSQL database server
                    cur.close()
                # commit the changes
                    conn.commit()

                except (Exception, psycopg2.DatabaseError) as error:
                    dlg = QtWidgets.QMessageBox()
                    new_icon = QtGui.QIcon()
                    new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                    dlg.setWindowIcon(new_icon)
                    dlg.setWindowTitle("ERP EIPSA")
                    dlg.setText("Ha ocurrido el siguiente error:\n"
                                + str(error))
                    dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                    dlg.exec()
                    del dlg, new_icon

                finally:
                    if conn is not None:
                        conn.close()

                if len(results) == 0:
                        dlg = QtWidgets.QMessageBox()
                        new_icon = QtGui.QIcon()
                        new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                        dlg.setWindowIcon(new_icon)
                        dlg.setWindowTitle("Prueba Hidrostática")
                        dlg.setText("El número de pedido introducido no existe. Introduce un pedido válido o pon 'ALMACÉN', 'INTERNO' o 'PROTOTIPOS'")
                        dlg.setIcon(QtWidgets.QMessageBox.Icon.Warning)
                        dlg.exec()
                        del dlg, new_icon

                else:
                    conn = None
                    try:
                    # read the connection parameters
                        params = config()
                    # connect to the PostgreSQL server
                        conn = psycopg2.connect(**params)
                        cur = conn.cursor()
                    # execution of commands
                        commands_hydrotest = f"""UPDATE verification.test_hydro SET num_order= '{num_order}', tag= '{tag}', item_type= '{description}', test1_date = '{date_test1}', manometer1 = '{manometer1}',
                        pressure1 = '{pressure1}', test1_state = '{test_state1}', obs1 = '{notes1}', test2_date = {date_test2},
                        manometer2 = '{manometer2}', pressure2 = '{pressure2}', test2_state = '{test_state2}', obs2 = '{notes2}', quantity = '{quantity}' WHERE id = {id_element}"""
                        cur.execute(commands_hydrotest)

                        dlg = QtWidgets.QMessageBox()
                        new_icon = QtGui.QIcon()
                        new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                        dlg.setWindowIcon(new_icon)
                        dlg.setWindowTitle("Prueba Hidrostática")
                        dlg.setText("Datos editados con éxito")
                        dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                        dlg.exec()
                        del dlg,new_icon

                    # close communication with the PostgreSQL database server
                        cur.close()
                    # commit the changes
                        conn.commit()

                    except (Exception, psycopg2.DatabaseError) as error:
                        dlg = QtWidgets.QMessageBox()
                        new_icon = QtGui.QIcon()
                        new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                        dlg.setWindowIcon(new_icon)
                        dlg.setWindowTitle("ERP EIPSA")
                        dlg.setText("Ha ocurrido el siguiente error:\n"
                                    + str(error))
                        dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                        dlg.exec()
                        del dlg, new_icon
                    finally:
                        if conn is not None:
                            conn.close()

            else:
                    conn = None
                    try:
                    # read the connection parameters
                        params = config()
                    # connect to the PostgreSQL server
                        conn = psycopg2.connect(**params)
                        cur = conn.cursor()
                    # execution of commands
                        commands_hydrotest = f"""UPDATE verification.test_hydro SET num_order= '{num_order}', tag= '{tag}', item_type= '{description}', test1_date = '{date_test1}', manometer1 = '{manometer1}',
                        pressure1 = '{pressure1}', test1_state = '{test_state1}', obs1 = '{notes1}', test2_date = {date_test2},
                        manometer2 = '{manometer2}', pressure2 = '{pressure2}', test2_state = '{test_state2}', obs2 = '{notes2}', quantity = '{quantity}' WHERE id = {id_element}"""
                        cur.execute(commands_hydrotest)

                        dlg = QtWidgets.QMessageBox()
                        new_icon = QtGui.QIcon()
                        new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                        dlg.setWindowIcon(new_icon)
                        dlg.setWindowTitle("Prueba Hidrostática")
                        dlg.setText("Datos editados con éxito")
                        dlg.setIcon(QtWidgets.QMessageBox.Icon.Information)
                        dlg.exec()
                        del dlg,new_icon

                    except (Exception, psycopg2.DatabaseError) as error:
                        dlg = QtWidgets.QMessageBox()
                        new_icon = QtGui.QIcon()
                        new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
                        dlg.setWindowIcon(new_icon)
                        dlg.setWindowTitle("ERP EIPSA")
                        dlg.setText("Ha ocurrido el siguiente error:\n"
                                    + str(error))
                        dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
                        dlg.exec()
                        del dlg, new_icon
                    finally:
                        if conn is not None:
                            conn.close()


    def load_values(self):
        """
        Loads the test values into the corresponding UI elements and populates the state dropdown with available states.
        """
        query_manometers = ("""
                            SELECT "manometer"
                            FROM verification.manometers
                            ORDER BY "id"
                            """)
        query_states = ("""
                            SELECT "state_verif"
                            FROM verification.states_verification
                            ORDER BY "id"
                            """)
        conn = None
        try:
        # read the connection parameters
            params = config()
        # connect to the PostgreSQL server
            conn = psycopg2.connect(**params)
            cur = conn.cursor()
        # execution of commands
            cur.execute(query_manometers)
            results=cur.fetchall()
            list_manometers = [x[0] for x in results]
            cur.execute(query_states)
            results=cur.fetchall()
            list_states = [x[0] for x in results]
        except (Exception, psycopg2.DatabaseError) as error:
            dlg = QtWidgets.QMessageBox()
            new_icon = QtGui.QIcon()
            new_icon.addPixmap(QtGui.QPixmap(os.path.abspath(os.path.join(basedir, "Resources/Iconos/icon.ico"))), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
            dlg.setWindowIcon(new_icon)
            dlg.setWindowTitle("ERP EIPSA")
            dlg.setText("Ha ocurrido el siguiente error:\n"
                        + str(error))
            dlg.setIcon(QtWidgets.QMessageBox.Icon.Critical)
            dlg.exec()
            del dlg, new_icon
        finally:
            if conn is not None:
                conn.close()

        self.manometer_test1.addItems(list_manometers)
        self.manometer_test2.addItems([''] + list_manometers)
        self.state_test1.addItems(list_states)
        self.state_test2.addItems([''] + list_states)

        self.id_test.setText(self.id_item)
        self.num_order_test.setText(self.num_order)
        self.tag_test.setText(self.tag)
        self.description_test.setText(self.description)
        self.qty_test.setText(self.qty)
        self.date_test1.setText(self.test_date1)
        self.manometer_test1.setCurrentText(self.manometer1)
        self.presure_test1.setText(self.pressure1)
        self.state_test1.setCurrentText(self.state1)
        self.obs_test1.setText(self.obs1)
        self.date_test2.setText(self.test_date2)
        self.manometer_test2.setCurrentText(self.manometer2)
        self.presure_test2.setText(self.pressure2)
        self.state_test2.setCurrentText(self.state2)
        self.obs_test2.setText(self.obs2)




if __name__ == "__main__":
    import sys
    import os

    ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
    if ROOT not in sys.path:
        sys.path.insert(0, ROOT)
    app = QtWidgets.QApplication(sys.argv)
    TestHydroEdit_Window = Ui_TestHydroEdit_Window()
    TestHydroEdit_Window.show()
    sys.exit(app.exec())